<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>ZXBox</title>
  <style>
      #scr {
        --pixel-size:2px;
      }
  </style>
</head>
<body>
  <div id="zxs"></div>

  <script src="index.js" type="module"></script>
  
  <script>


    function dump() {
      // 6144, 6912, 3072
      for( let pp=0; pp<6912; pp++) {
        zx.poke(16384+pp, (~~(Math.random()*256)))
      }
    }
    
    document.onclick = dump

    function load(fname = 'test1') {
      let byte, ci, cp, cb, cf
      let oReq = new XMLHttpRequest();
      oReq.open("GET", `/${fname}.scr`, true);
      oReq.responseType = "arraybuffer";

      oReq.onload = function (oEvent) {
        let arrayBuffer = oReq.response;
        if (arrayBuffer) {
          let byteArray = new Uint8Array(arrayBuffer);
          for (var i = 0; i < byteArray.byteLength; i++) {
            if (i<6144) {
              bytes[zxAddrToByteElOffset(i+16384)].innerHTML = byteToHTML(byteArray[i])
            } else {
              [ci, cp, cb, cf] = attrToIPBF(byteArray[i])
              chars[i-6144].className = `char i${ci} p${cp} ${cb?'b':''} ${cf?'f':''}`
            }
          }
        }
      };

      oReq.send(null);

    }




  
  </script>
</body>
</html>